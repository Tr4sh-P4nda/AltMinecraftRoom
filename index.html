<!DOCTYPE html>
<html lang='en'>

	<head>

		<title>AltMinecraft</title>
		<script src="http://livejs.com/live.js"></script>
		<script src="https://aframe.io/releases/0.3.0/aframe.min.js"></script>
		<script src="./assets/aframe-component-beta.js"></script>
		<script src="./assets/altspace.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<script src="http://xirvr.com/aframe-gltf/demo/aframe-gltf.js"></script>

	</head>

	<body>

		<a-scene altspace='fullspace: true'>

			<a-assets timeout="30000">
				<!--<a-asset-item id="mcroom" src="./assets/mcroom.dae"></a-asset-item>-->
				<a-asset-item id="collision-obj" src="./assets/collision.obj"></a-asset-item>
				<a-asset-item id="room1" src="world6_0.gltf">
				<a-asset-item id="room2" src="world6_1.gltf">
				<a-asset-item id="room3" src="world6_2.gltf">
				<a-asset-item id="room4" src="world6_3.gltf">
			</a-assets>

			<!--<a-entity position="0 -2 18" collada-model="#mcroom" scale="1.05 1.05 1.05" id="mcroom-a" transparent=true altspace-cursor-collider="enabled: false"></a-entity>-->
			<a-entity position="19 -2 0" id="gltf" gltf-model="asset: #room1;" scale="1.05 1.05 1.05" id="mcroom-a" transparent=true altspace-cursor-collider="enabled: false">
			<a-entity position="19 -2 0" id="gltf" gltf-model="asset: #room2;" scale="1.05 1.05 1.05" id="mcroom-a" transparent=true altspace-cursor-collider="enabled: false">
			<a-entity position="19 -2 0" id="gltf" gltf-model="asset: #room3;" scale="1.05 1.05 1.05" id="mcroom-a" transparent=true altspace-cursor-collider="enabled: false">
			<a-entity position="19 -2 0" id="gltf" gltf-model="asset: #room4;" scale="1.05 1.05 1.05" id="mcroom-a" transparent=true altspace-cursor-collider="enabled: false">
			<a-entity position="0 -2 18" obj-model="obj: #collision-obj;" scale="1.05 1.05 1.05" id="collision-a" n-mesh-collider="type:environment; convex: false;" transparent=true altspace-cursor-collider="enabled: true"></a-entity>

		</a-scene>

		<script>

			/*var room = document.querySelector('#mcroom-a');
			//When model is loaded, set transparent to true for certain meshes
			room.addEventListener('model-loaded', function() {
				for (var i = 0; i < this.object3D.children[0].children.length; i++) {
					var meshy = this.object3D.children[0].children[i];
					if (meshy.name != undefined && (meshy.name.indexOf("Glass") !== -1 || meshy.name.indexOf("Leaves_(Acacia/Dark_Oak)") !== -1 || meshy.name.indexOf("Poppy") !== -1 || meshy.name.indexOf("Stationary_Water") !== -1 || meshy.name.indexOf("Torch") !== -1 || meshy.name.indexOf("Vines") !== -1)) {
						var top = meshy.children[0];
						top.material.transparent = true;
						top.material.side = THREE.DoubleSide;
						top.material.needsUpdate = true;
					}
				}
			});*/

			//Hide collision mesh
			var collision = document.querySelector('#collision-a');
			collision.addEventListener('model-loaded', function() {
				for (var i = 0; i < this.object3D.children[0].children.length; i++) {
					var top = this.object3D.children[0].children[i];
					top.material.visible = false;
					top.material.needsUpdate = true;
					top.needsUpdate = true;
				}
			});

			//Check for GitHub pushes
			var lastupdate = "";

			setInterval(function(e) {
				$.ajax({
					type: "GET",
					url: "http://altvr.jacobralph.org/minecraft/lastupdate.txt",
					async: true,
					success: function(text) {
						if (!lastupdate) {
							lastupdate = text;
						} else {
							if (lastupdate != text) {
								location.reload(true);
							}
						}
					}
				});
			}, 5000);

		</script>

	</body>

</html>